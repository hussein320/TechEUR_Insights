<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Data Visualization</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      #yearSelect {
        padding: 10px;
        background-color: #f4f4f4;
        margin-right: 10px;
        display: inline-block;
        vertical-align: top;
        border-radius: 5px;
        color: #333;
        box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
        transition: border-color 0.3s, box-shadow 0.3s;
        border: none;
      }

      #yearSelect:focus {
        outline: none;
      }

      .dropdown {
        position: relative;
        background-color: #f4f4f4;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        width: 25%;
        height: 21px;
        padding: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .selection-container {
        display: flex;
        align-items: center;
        justify-content: start;
        gap: 10px;
        padding: 10px;
      }
      .dropdown-select {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }

      .dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        display: none;
        max-height: 200px;
        z-index: 1000;
      }

      .dropdown-list label {
        padding: 10px;
        margin-right: 10px;
        display: inline-block;
        vertical-align: top;
        width: 100%;
      }

      .dropdown-list label:hover {
        background-color: #d5e8fc;
        color: #0c0a0a;
      }

      .dropdown-list label.selected {
        background-color: #007bff;
        color: #fff;
      }

      .dropdown-list input[type="checkbox"] {
        display: none;
      }
      .dropdown-list label.unavailable {
        background-color: #ccc;
        color: #767676;
        pointer-events: none;
      }
      .label {
        font-family: "Roboto";
      }
      .axis-title {
        font-family: "Roboto";
      }
      .selectt {
        font-family: "Roboto";
      }
    </style>
  </head>
  <body>
    <div class="selection-container">
      <label for="yearSelect" class="selectt">Select :</label>
      <select id="yearSelect"></select>

      <div class="dropdown">
        <div class="dropdown-select">
          <span class="selectt">Check Countries</span>
          <i class="arrow down"></i>
        </div>
        <div class="dropdown-list"></div>
      </div>
    </div>

    <div id="my_dataviz"></div>

    <script>
      var data = [
        {
          country: "EU",
          years: {
            2008: "1.91",
            2009: "2.09",
            2010: "2.17",
            2011: "2.26",
            2012: "2.35",
            2013: "2.41",
            2014: "2.47",
            2015: "2.57",
            2016: "2.6",
            2017: "2.7",
            2018: " 2.83",
            2019: "2.72",
            2020: "2.84",
          },
        },
        {
          country: "Belgium",
          years: {
            2008: "2.51",
            2009: "2.48",
            2010: "2.56",
            2011: "2.52",
            2012: "2.5",
            2013: "2.57",
            2014: "2.48",
            2015: "2.46",
            2016: "2.51",
            2017: "2.55",
            2018: "2.72",
            2019: "2.82",
            2020: "2.81",
          },
        },
        {
          country: "Bulgaria",
          years: {
            2008: "1.4",
            2009: "1.59",
            2010: "1.66",
            2011: "1.74",
            2012: "1.88",
            2013: "1.98",
            2014: "2.04",
            2015: "2.21",
            2016: "2.43",
            2017: "2.55",
            2018: "2.68",
            2019: "2.87",
            2020: "3.07",
          },
        },
        {
          country: "Czechia",
          years: {
            2008: "2.04",
            2009: "2.09",
            2010: "2.14",
            2011: "2.2",
            2012: "2.25",
            2013: "2.28",
            2014: "2.35",
            2015: "2.39",
            2016: "2.48",
            2017: "2.6",
            2018: "2.69",
            2019: "2.81",
            2020: "2.91",
          },
        },
        {
          country: "Denmark",
          years: {
            2008: "2.94",
            2009: "2.92",
            2010: "3",
            2011: "3.88",
            2012: "3.86",
            2013: "3.85",
            2014: "3.78",
            2015: "3.81",
            2016: "3.25",
            2017: "3.28",
            2018: "3.36",
            2019: "3.44",
            2020: "3.51",
          },
        },
        {
          country: "Germany",
          years: {
            2008: "1.9",
            2009: "1.92",
            2010: "1.92",
            2011: "2.05",
            2012: "2.03",
            2013: "2.15",
            2014: "2.29",
            2015: "2.35",
            2016: "2.44",
            2017: "2.52",
            2018: "2.83",
            2019: "2.81",
            2020: "2.82",
          },
        },
        {
          country: "Estonia",
          years: {
            2008: "2.05",
            2009: "2.19",
            2010: "2.26",
            2011: "2.47",
            2012: "2.6",
            2013: "2.63",
            2014: "2.77",
            2015: "2.82",
            2016: "2.92",
            2017: "3.29",
            2018: "3.51",
            2019: "3.97",
            2020: ":",
          },
        },
        {
          country: "Ireland",
          years: {
            2008: ":",
            2009: ":",
            2010: ":",
            2011: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2016: ":",
            2017: ":",
            2018: ":",
            2019: ":",
            2020: ":",
          },
        },
        {
          country: "Greece",
          years: {
            2008: "1.35",
            2009: "1.23",
            2010: "1.21",
            2011: "1.26",
            2012: "1.33",
            2013: "1.2",
            2014: "1.44",
            2015: "1.41",
            2016: "1.39",
            2017: "1.41",
            2018: "1.43",
            2019: "1.49",
            2020: "1.59",
          },
        },
        {
          country: "Spain",
          years: {
            2008: "1.85",
            2009: "1.9",
            2010: "1.93",
            2011: "2.02",
            2012: "2.13",
            2013: "2.11",
            2014: "2.13",
            2015: "2.21",
            2016: "2.29",
            2017: "2.34",
            2018: "2.4",
            2019: "2.45",
            2020: "2.7",
          },
        },
        {
          country: "France",
          years: {
            2008: ":",
            2009: ":",
            2010: "2.52",
            2011: "2.56",
            2012: "2.63",
            2013: "2.59",
            2014: "2.75",
            2015: "2.7",
            2016: "2.73",
            2017: "2.85",
            2018: "2.76",
            2019: "2.78",
            2020: "2.95",
          },
        },
        {
          country: "Croatia",
          years: {
            2008: "1.5",
            2009: "1.55",
            2010: "1.73",
            2011: "1.75",
            2012: "1.81",
            2013: "1.96",
            2014: "2",
            2015: "2.08",
            2016: "2.13",
            2017: "2.24",
            2018: "2.31",
            2019: "2.56",
            2020: "2.72",
          },
        },
        {
          country: "Italy",
          years: {
            2008: "2.11",
            2009: "2.19",
            2010: "2.15",
            2011: "2.06",
            2012: "2.08",
            2013: "2.12",
            2014: "2.09",
            2015: "2.13",
            2016: "2.2",
            2017: "2.23",
            2018: "2.21",
            2019: "2.23",
            2020: "2.33",
          },
        },
        {
          country: "Cyprus",
          years: {
            2008: "1.71",
            2009: "1.67",
            2010: "1.86",
            2011: "1.87",
            2012: "2",
            2013: "2.12",
            2014: "2.25",
            2015: "2.25",
            2016: "2.33",
            2017: "2.41",
            2018: "2.65",
            2019: "2.89",
            2020: "3.07",
          },
        },
        {
          country: "Latvia",
          years: {
            2008: "1.67",
            2009: "1.82",
            2010: "1.95",
            2011: "2.05",
            2012: "2.35",
            2013: "2.5",
            2014: "2.89",
            2015: "3.14",
            2016: "3.43",
            2017: "3.66",
            2018: "3.97",
            2019: "3.95",
            2020: "4.19",
          },
        },
        {
          country: "Lithuania",
          years: {
            2008: "1.35",
            2009: "1.42",
            2010: "1.59",
            2011: "1.69",
            2012: "1.81",
            2013: "1.95",
            2014: "2.09",
            2015: "2.24",
            2016: "2.34",
            2017: "2.43",
            2018: "2.5",
            2019: "2.65",
            2020: "2.88",
          },
        },
        {
          country: "Luxembourg",
          years: {
            2008: "3.87",
            2009: "3.94",
            2010: "4",
            2011: "4.06",
            2012: "4.05",
            2013: "4.11",
            2014: "4.17",
            2015: "4.13",
            2016: "4.15",
            2017: "4.31",
            2018: "4.38",
            2019: "4.4",
            2020: "4.44",
          },
        },
        {
          country: "Hungary",
          years: {
            2008: "2.17",
            2009: "2.2",
            2010: "2.3",
            2011: "2.35",
            2012: "2.44",
            2013: "2.44",
            2014: "2.52",
            2015: "2.53",
            2016: "2.56",
            2017: "2.61",
            2018: "2.67",
            2019: "2.82",
            2020: "2.91",
          },
        },
        {
          country: "Malta",
          years: {
            2008: ":",
            2009: ":",
            2010: ":",
            2011: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2016: ":",
            2017: ":",
            2018: "3.71",
            2019: ":",
            2020: "3.74",
          },
        },
        {
          country: "Netherlands",
          years: {
            2008: ":",
            2009: "2.96",
            2010: "2.91",
            2011: "2.94",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2016: ":",
            2017: ":",
            2018: ":",
            2019: ":",
            2020: ":",
          },
        },
        {
          country: "Austria",
          years: {
            2008: "1.92",
            2009: "1.92",
            2010: "1.99",
            2011: "2.04",
            2012: "2.09",
            2013: "2.14",
            2014: "2.19",
            2015: "2.19",
            2016: "2.26",
            2017: "2.32",
            2018: "2.33",
            2019: "2.39",
            2020: "2.51",
          },
        },
        {
          country: "Poland",
          years: {
            2008: "1.22",
            2009: "1.28",
            2010: "1.36",
            2011: "1.45",
            2012: "1.54",
            2013: "1.64",
            2014: "1.73",
            2015: "1.87",
            2016: "2.04",
            2017: "2.2",
            2018: "2.26",
            2019: "2.42",
            2020: "2.51",
          },
        },
        {
          country: "Portugal",
          years: {
            2008: "1.32",
            2009: "1.4",
            2010: "1.44",
            2011: "1.53",
            2012: "1.62",
            2013: "1.69",
            2014: "1.73",
            2015: "1.82",
            2016: "1.87",
            2017: "1.97",
            2018: "2.09",
            2019: "2.32",
            2020: "2.53",
          },
        },
        {
          country: "Romania",
          years: {
            2008: "1.35",
            2009: "1.31",
            2010: "1.32",
            2011: "1.43",
            2012: "1.5",
            2013: "1.63",
            2014: "1.71",
            2015: "1.85",
            2016: "2",
            2017: "2.08",
            2018: "2.22",
            2019: "2.28",
            2020: "2.42",
          },
        },
        {
          country: "Slovenia",
          years: {
            2008: "1.78",
            2009: "1.89",
            2010: "1.93",
            2011: "1.97",
            2012: "2.04",
            2013: "2.16",
            2014: "2.19",
            2015: "2.27",
            2016: "2.31",
            2017: "2.34",
            2018: "2.38",
            2019: "2.45",
            2020: "2.62",
          },
        },
        {
          country: "Slovakia",
          years: {
            2008: "1.61",
            2009: "1.34",
            2010: "1.89",
            2011: "2.15",
            2012: "2.15",
            2013: ":",
            2014: "2.29",
            2015: "2.39",
            2016: "2.52",
            2017: "2.65",
            2018: "2.77",
            2019: "2.87",
            2020: "3.03",
          },
        },
        {
          country: "Finland",
          years: {
            2008: "2.76",
            2009: "2.82",
            2010: "2.8",
            2011: "2.83",
            2012: "2.89",
            2013: ":",
            2014: "3.03",
            2015: "3.06",
            2016: "3.14",
            2017: "3.28",
            2018: "3.34",
            2019: "3.45",
            2020: "3.62",
          },
        },
        {
          country: "Sweden",
          years: {
            2008: "3.84",
            2009: ":",
            2010: ":",
            2011: ":",
            2012: "3.87",
            2013: "4.04",
            2014: "3.9",
            2015: "4.41",
            2016: "4.47",
            2017: "4.55",
            2018: "4.61",
            2019: "4.75",
            2020: "4.74",
          },
        },
        {
          country: "Iceland",
          years: {
            2008: ":",
            2009: ":",
            2010: ":",
            2011: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2016: ":",
            2017: ":",
            2018: ":",
            2019: ":",
            2020: ":",
          },
        },
        {
          country: "Norway",
          years: {
            2008: ":",
            2009: "2.69",
            2010: "2.74",
            2011: "2.77",
            2012: "2.78",
            2013: "2.79",
            2014: "2.84",
            2015: "2.89",
            2016: "2.86",
            2017: "2.92",
            2018: "2.98",
            2019: "3.08",
            2020: "3.2",
          },
        },
        {
          country: "Switzerland",
          years: {
            2008: ":",
            2009: "2.51",
            2010: "2.23",
            2011: "2.29",
            2012: "2.43",
            2013: "2.47",
            2014: "2.56",
            2015: "2.47",
            2016: "2.54",
            2017: "2.6",
            2018: "2.64",
            2019: "2.72",
            2020: "2.86",
          },
        },
        {
          country: "United Kingdom",
          years: {
            2008: "3.06",
            2009: "3.04",
            2010: "3.09",
            2011: "3.03",
            2012: "2.88",
            2013: "3.1",
            2014: ":",
            2015: "3.31",
            2016: ":",
            2017: ":",
            2018: ":",
            2019: ":",
            2020: ":",
          },
        },
      ];

      var years = [
        "2008",
        "2009",
        "2010",
        "2011",
        "2012",
        "2013",
        "2014",
        "2015",
        "2016",
        "2017",
        "2018",
        "2019",
        "2020",
      ];
      var countries = data.map((d) => d.country);
      var selectedYear;
      var selectedCountries = [];
      let count = 0;
      document.addEventListener("DOMContentLoaded", function () {
        var dropdown = document.querySelector(".dropdown");
        var dropdownList = document.querySelector(".dropdown-list");
        var yearSelect = d3.select("#yearSelect");

        yearSelect
          .selectAll("option")
          .data(years)
          .enter()
          .append("option")
          .text((d) => d)
          .attr("value", (d) => d)
          .style("font-family", "Roboto");

        yearSelect.on("change", function () {
          selectedYear = d3.select(this).property("value");
          updateChartAndCheckboxes(selectedYear);
        });
        let checkedCount = 0;
        countries.forEach(function (country) {
          var countryData = data.find((d) => d.country === country);
          if (country !== "EU") {
            var label = document.createElement("label");
            label.style.fontFamily = "Roboto";
            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = country;

            if (
              countryData &&
              countryData.years[yearSelect.property("value")] === ":"
            ) {
              checkbox.disabled = true;
            }

            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(country));
            dropdownList.appendChild(label);

            // Toggle checkbox and update selected countries list
            label.addEventListener("click", function () {
              if (!checkbox.checked && checkedCount < 12) {
                checkbox.checked = true;
                checkedCount++;
                label.classList.toggle("selected", true);
                selectedCountries.push(checkbox.value);
                updateChartAndCheckboxes(selectedYear);
              }
              // If the checkbox is already checked
              else if (checkbox.checked) {
                checkbox.checked = false;
                checkedCount--;
                label.classList.toggle("selected", false);
                selectedCountries = selectedCountries.filter(
                  (country) => country !== checkbox.value
                );
                updateChartAndCheckboxes(selectedYear);
              }
            });
          }
        });

        // Toggle dropdown visibility
        document
          .querySelector(".dropdown-select")
          .addEventListener("click", function () {
            dropdownList.style.display =
              dropdownList.style.display === "none" ? "block" : "none";
          });

        // Hide dropdown if clicked outside
        document.addEventListener("click", function (e) {
          if (!dropdown.contains(e.target)) {
            dropdownList.style.display = "none";
          }
        });

        // Update chart and checkboxes availability
        function updateChartAndCheckboxes(selectedYear) {
          updateChart(selectedYear, selectedCountries);
          updateCountryCheckboxesAvailability(selectedYear);
        }

        // Update checkboxes availability based on selected year
        function updateCountryCheckboxesAvailability(selectedYear) {
          var checkboxes = dropdownList.querySelectorAll(
            "input[type='checkbox']"
          );
          checkboxes.forEach(function (checkbox) {
            var countryData = data.find((d) => d.country === checkbox.value);
            var label = checkbox.parentElement;

            if (!countryData || countryData.years[selectedYear] === ":") {
              checkbox.disabled = true;
              checkbox.checked = false;
              label.classList.add("unavailable");
              label.textContent = label.textContent.trim() + " (Unavailable)";
            } else {
              checkbox.disabled = false;
              label.classList.remove("unavailable");
              label.textContent = checkbox.value;
            }
          });
        }

        // Initialize selectedYear and update chart
        selectedYear = yearSelect.property("value");
        updateChartAndCheckboxes(selectedYear);
      });

      let width = window.innerWidth * 0.8,
        height = window.innerHeight * 0.6,
        margin = {
          top: window.innerHeight * 0.05,
          right: window.innerHeight * 0.1,
          bottom: window.innerHeight * 0.1,
          left: window.innerWidth * 0.1,
        };

      var svg = d3
        .select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .style("position", "absolute")
        .style("top", "110px")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      filteredData = [{ country: "EU", value: 1.91 }];

      var xScale = d3
        .scaleBand()
        .range([0, width])
        .padding(0.1)
        .domain(filteredData.map((d) => d.country));

      var yScale = d3.scaleLinear().range([height, 0]).domain([0, 2]);

      svg
        .append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(xScale))
        .selectAll("text")
        .style("font-family", "Roboto");

      svg
        .append("g")
        .call(d3.axisLeft(yScale))
        .selectAll("text")
        .style("font-family", "Roboto");
      var gradient = svg
        .append("defs")
        .append("linearGradient")
        .attr("id", "barGradient")
        .attr("gradientUnits", "userSpaceOnUse")
        .attr("x1", "0")
        .attr("y1", yScale(0))
        .attr("x2", "0")
        .attr("y2", yScale(d3.max(filteredData, (d) => d.value)));
      gradient
        .append("stop")
        .attr("offset", "0%")
        .attr("stop-color", "#33aed6"); // Light blue start color
      gradient
        .append("stop")
        .attr("offset", "100%")
        .attr("stop-color", "#0000ff"); // Dark blue end color

      svg
        .selectAll(".bar")
        .data(filteredData)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", (d) => xScale(d.country))
        .attr("width", xScale.bandwidth())
        .attr("y", (d) => yScale(d.value))
        .attr("height", (d) => height - yScale(d.value))
        .attr("fill", "url(#barGradient)");

      svg
        .selectAll(".label")
        .data(filteredData)
        .enter()
        .append("text")
        .attr("class", "label")
        .attr("x", (d) => xScale(d.country) + xScale.bandwidth() / 2)
        .attr("y", (d) => yScale(d.value) - 5)
        .attr("text-anchor", "middle")
        .text((d) => d.value)
        .style("fill", "#333") // Text color
        .style("font-size", "12px")
        .style("font-weight", "bold")
        .style("font-family", "Roboto");

      function updateChart(year, selectedCountries) {
        selectedCountries.push("EU");
        console.log(selectedCountries);
        var filteredData = data
          .filter((d) => selectedCountries.includes(d.country))
          .map((d) => {
            return { country: d.country, value: d.years[year] || 0 };
          });

        svg.selectAll("*").remove();

        var xScale = d3
          .scaleBand()
          .range([0, width])
          .padding(0.1)
          .domain(filteredData.map((d) => d.country));

        var yScale = d3
          .scaleLinear()
          .range([height, 0])
          .domain([0, d3.max(filteredData, (d) => +d.value) + 0.3]);

        svg
          .append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(xScale))
          .selectAll("text")
          .style("font-family", "Roboto");

        svg
          .append("g")
          .call(d3.axisLeft(yScale))
          .selectAll("text")
          .style("font-family", "Roboto");

        var gradient = svg
          .append("defs")
          .append("linearGradient")
          .attr("id", "barGradient")
          .attr("gradientUnits", "userSpaceOnUse")
          .attr("x1", "0")
          .attr("y1", yScale(0))
          .attr("x2", "0")
          .attr("y2", yScale(d3.max(filteredData, (d) => d.value)));
        gradient
          .append("stop")
          .attr("offset", "0%")
          .attr("stop-color", "#33aed6");
        gradient
          .append("stop")
          .attr("offset", "100%")
          .attr("stop-color", "#0000ff");

        svg
          .selectAll(".bar")
          .data(filteredData)
          .enter()
          .append("rect")
          .attr("class", "bar")
          .attr("x", (d) => xScale(d.country))
          .attr("width", xScale.bandwidth())
          .attr("y", yScale(0))
          .attr("height", 0)
          .attr("fill", "url(#barGradient)")
          .transition()
          .duration(750)
          .attr("y", (d) => yScale(d.value))
          .attr("height", (d) => height - yScale(d.value));

        svg
          .selectAll(".label")
          .data(filteredData)
          .enter()
          .append("text")
          .attr("class", "label")
          .attr("x", (d) => xScale(d.country) + xScale.bandwidth() / 2)
          .attr("y", height)
          .attr("text-anchor", "middle")
          .text((d) => d.value)
          .style("fill-opacity", 0)
          .transition()
          .duration(750)
          .attr("y", (d) => yScale(d.value) - 5)
          .style("fill-opacity", 1)
          .style("fill", "#333")
          .style("font-size", "12px")
          .style("font-weight", "bold");

        // Axis titles
        svg
          .append("text")
          .attr("class", "axis-title")
          .attr("x", width / 2)
          .attr("y", height + 60)
          .style("text-anchor", "middle")
          .style("font-size", "16px")
          .text("Countries");

        svg
          .append("text")
          .attr("class", "axis-title")
          .attr("transform", "rotate(-90)")
          .attr("x", -height / 2)
          .attr("y", -50)
          .style("text-anchor", "middle")
          .style("font-size", "16px")
          .text("% of ICT Personnel in Total Employment");
      }
    </script>
  </body>
</html>
