<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Europe Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .tooltip {
        position: absolute;
        text-align: center;
        padding: 8px;
        font: 12px sans-serif;
        background: rgb(254, 254, 255);
        border: 2px solid black;
        border-radius: 8px;
        pointer-events: none;
        opacity: 0;
        font-family: "roboto";
      }

      .country-path {
        transition: fill 0.4s, stroke-width 0.2s, transform 0.2s;
      }

      .country-path:hover {
        cursor: pointer;
        stroke-width: 2;
        transform: scale(1.02);
        stroke: rgb(0, 0, 0);
      }

      .time-traveler {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 20%;
        max-width: 500px;
        min-width: 50px;
        max-height: 20px;
        padding: 10px;
        background-color: #d4e6f4;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .button {
        cursor: pointer;
        border: none;
        background-color: transparent;
        font-size: 14px;
        margin: 5px;
      }

      .year-display,
      .country-display {
        font-size: 18px;
        font-family: "Roboto", sans-serif;
        margin: 10px 0;
      }

      .map-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        left: 20%;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
      }

      svg {
        overflow: visible;
      }
    </style>
  </head>
  <body>
    <div class="map-container">
      <svg class="Testing"></svg>
      <div class="tooltip">Tooltip</div>
    </div>
    <div class="time-traveler">
      <button class="button" id="prevYear">
        <i class="fas fa-arrow-left"></i>
      </button>
      <span class="year-display">Year: 2010</span>
      <button class="button" id="nextYear">
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
    <script>
      let width = window.innerWidth * 0.4,
        height = window.innerHeight * 0.7;
      let currentYear = 2010;
      countries = [
        "EU",
        "Belgium",
        "Bulgaria",
        "Czechia",
        "Denmark",
        "Germany",
        "Estonia",
        "Ireland",
        "Spain",
        "France",
        "Italy",
        "Cyprus",
        "Luxembourg",
        "Hungary",
        "Malta",
        "Netherlands",
        "Austria",
        "Poland",
        "Portugal",
        "Romania",
        "Slovenia",
        "Finland",
        "Sweden",
        "Norway",
      ];
      let data = [
        {
          country: "EU",
          years: {
            2010: "17.5",
            2012: "19.2",
            2013: "16",
            2014: "20.1",
            2015: "21.0",
            2017: "21.1",
            2019: "18.5",
            2021: "19.5",
          },
        },
        {
          country: "Belgium",
          years: {
            2010: "28.4",
            2012: "24.2",
            2013: ":",
            2014: "22.2",
            2015: "23.6",
            2017: "26.9",
            2019: "24.9",
            2021: "25.7",
          },
        },
        {
          country: "Bulgaria",
          years: {
            2010: "10.2",
            2012: "13.3",
            2013: "11.2",
            2014: "15.7",
            2015: "13.3",
            2017: "12.8",
            2019: "10.9",
            2021: "11.2",
          },
        },
        {
          country: "Czechia",
          years: {
            2010: "10.3",
            2012: "17.2",
            2013: ":",
            2014: "15.7",
            2015: "17.4",
            2017: "16.4",
            2019: "14.9",
            2021: "11.5",
          },
        },
        {
          country: "Denmark",
          years: {
            2010: "17.9",
            2012: "21.4",
            2013: ":",
            2014: "23.5",
            2015: "22.8",
            2017: "23.3",
            2019: "22.7",
            2021: "25.8",
          },
        },
        {
          country: "Germany",
          years: {
            2010: "23.4",
            2012: "23.0",
            2013: ":",
            2014: "23.9",
            2015: "23.7",
            2017: "25.8",
            2019: "20.3",
            2021: "20.0",
          },
        },
        {
          country: "Estonia",
          years: {
            2010: "9.3",
            2012: "10.3",
            2013: "10.7",
            2014: "15.3",
            2015: "19.9",
            2017: "15.2",
            2019: "16.3",
            2021: "14.6",
          },
        },
        {
          country: "Ireland",
          years: {
            2010: "24.6",
            2012: "26.4",
            2013: "24.8",
            2014: "25.9",
            2015: "27.4",
            2017: "26.5",
            2019: "25.1",
            2021: "19.4",
          },
        },
        {
          country: "Greece",
          years: {
            2010: "17.9",
            2012: ":",
            2013: "11.2",
            2014: "13.0",
            2015: "14.9",
            2017: "15.5",
            2019: "15.7",
            2021: "16.1",
          },
        },
        {
          country: "Spain",
          years: {
            2010: "20.3",
            2012: "21.2",
            2013: "23.3",
            2014: "27.3",
            2015: "26.5",
            2017: "28.0",
            2019: "23.9",
            2021: "29.4",
          },
        },
        {
          country: "France",
          years: {
            2010: "15.3",
            2012: "19.2",
            2013: ":",
            2014: "15.2",
            2015: "19.5",
            2017: "17.8",
            2019: "14.7",
            2021: "16.7",
          },
        },
        {
          country: "Croatia",
          years: {
            2010: "10.6",
            2012: "13.2",
            2013: "14.0",
            2014: "12.2",
            2015: "15.4",
            2017: "12.2",
            2019: "10.2",
            2021: "10.5",
          },
        },
        {
          country: "Italy",
          years: {
            2010: "14.5",
            2012: "17.4",
            2013: "16.6",
            2014: "18.3",
            2015: "18.7",
            2017: "18.4",
            2019: "15.0",
            2021: "17.0",
          },
        },
        {
          country: "Cyprus",
          years: {
            2010: "16.1",
            2012: "18.8",
            2013: "16.4",
            2014: "21.6",
            2015: "26.3",
            2017: "29.2",
            2019: "19.3",
            2021: "25.1",
          },
        },
        {
          country: "Latvia",
          years: {
            2010: "11.3",
            2012: "13.2",
            2013: "12.1",
            2014: "10.4",
            2015: "13.6",
            2017: "13.2",
            2019: "12.2",
            2021: "12.4",
          },
        },
        {
          country: "Lithuania",
          years: {
            2010: "12.4",
            2012: "13.8",
            2013: "11.6",
            2014: "18.7",
            2015: "22.8",
            2017: "24.5",
            2019: "24.4",
            2021: "22.0",
          },
        },
        {
          country: "Luxembourg",
          years: {
            2010: "19.0",
            2012: "17.5",
            2013: "20.5",
            2014: "22.0",
            2015: "22.2",
            2017: "23.0",
            2019: "17.6",
            2021: "19.0",
          },
        },
        {
          country: "Hungary",
          years: {
            2010: "7.0",
            2012: "7.4",
            2013: "8.4",
            2014: "9.3",
            2015: "9.2",
            2017: "8.5",
            2019: "6.8",
            2021: "7.6",
          },
        },
        {
          country: "Malta",
          years: {
            2010: "20.1",
            2012: "19.5",
            2013: ":",
            2014: "22.3",
            2015: "21.5",
            2017: "20.0",
            2019: "24.8",
            2021: "30.8",
          },
        },
        {
          country: "Netherlands",
          years: {
            2010: "16.0",
            2012: "19.5",
            2013: "21.6",
            2014: "26.9",
            2015: "29.6",
            2017: "28.4",
            2019: "25.6",
            2021: "27.3",
          },
        },
        {
          country: "Austria",
          years: {
            2010: "28.5",
            2012: "28.7",
            2013: "25.8",
            2014: "29.3",
            2015: "26.3",
            2017: "27.4",
            2019: "22.1",
            2021: "24.3",
          },
        },
        {
          country: "Poland",
          years: {
            2010: "13.1",
            2012: "13.0",
            2013: "15.9",
            2014: "16.5",
            2015: "17.7",
            2017: "16.4",
            2019: "20.5",
            2021: "21.3",
          },
        },
        {
          country: "Portugal",
          years: {
            2010: "15.3",
            2012: "17.6",
            2013: "19.9",
            2014: "19.3",
            2015: "22.4",
            2017: "17.8",
            2019: "16.7",
            2021: "15.6",
          },
        },
        {
          country: "Romania",
          years: {
            2010: "14.3",
            2012: "13.4",
            2013: "11.2",
            2014: "13.5",
            2015: "15.4",
            2017: "13.4",
            2019: "14.3",
            2021: "10.9",
          },
        },
        {
          country: "Slovenia",
          years: {
            2010: "11.0",
            2012: "15.2",
            2013: "16.6",
            2014: "15.8",
            2015: "17.0",
            2017: "13.5",
            2019: "10.4",
            2021: "12.6",
          },
        },
        {
          country: "Slovakia",
          years: {
            2010: "25.2",
            2012: "19.6",
            2013: "18.6",
            2014: "15.6",
            2015: "16.7",
            2017: "16.9",
            2019: "15.4",
            2021: "15.7",
          },
        },
        {
          country: "Finland",
          years: {
            2010: "27.4",
            2012: "26.7",
            2013: "31.1",
            2014: "30.5",
            2015: "28.1",
            2017: "23.0",
            2019: "26.5",
            2021: "27.7",
          },
        },
        {
          country: "Sweden",
          years: {
            2010: "23.8",
            2012: "25.3",
            2013: ":",
            2014: "24.9",
            2015: ":",
            2017: "20.4",
            2019: "21.0",
            2021: "22.6",
          },
        },
        {
          country: "Iceland",
          years: {
            2010: "15.2",
            2012: "16.0",
            2013: "11.3",
            2014: "12.7",
            2015: ":",
            2017: "9.6",
            2019: ":",
            2021: ":",
          },
        },
        {
          country: "Liechtenstein",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2017: ":",
            2019: ":",
            2021: ":",
          },
        },
        {
          country: "Norway",
          years: {
            2010: "22.4",
            2012: "23.6",
            2013: "18.4",
            2014: "20.6",
            2015: "20.6",
            2017: "20.1",
            2019: "16.4",
            2021: "21.3",
          },
        },
        {
          country: "Switzerland",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2017: ":",
            2019: ":",
            2021: ":",
          },
        },
        {
          country: "United Kingdom",
          years: {
            2010: "12.8",
            2012: "16.9",
            2013: ":",
            2014: "16.9",
            2015: "20.2",
            2017: "21.1",
            2019: "16.8",
            2021: ":",
          },
        },
        {
          country: "Bosnia and Herzegovina",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2017: ":",
            2019: "8.6",
            2021: "11.1",
          },
        },
        {
          country: "Montenegro",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2017: ":",
            2019: ":",
            2021: "23.1",
          },
        },
        {
          country: "North Macedonia",
          years: {
            2010: "11.4",
            2012: "14.1",
            2013: "11.7",
            2014: "16.4",
            2015: "14.1",
            2017: ":",
            2019: ":",
            2021: "10.5",
          },
        },
        {
          country: "Albania",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: ":",
            2017: ":",
            2019: ":",
            2021: "19.8",
          },
        },
        {
          country: "Serbia",
          years: {
            2010: ":",
            2012: ":",
            2013: ":",
            2014: "12.3",
            2015: ":",
            2017: "11.7",
            2019: "13.1",
            2021: "6.7",
          },
        },
        {
          country: "Türkiye",
          years: {
            2010: "21.2",
            2012: ":",
            2013: ":",
            2014: ":",
            2015: "6.5",
            2017: "13.6",
            2019: "13.4",
            2021: "7.6",
          },
        },
      ];

      var margin = { top: 50, right: 180, bottom: 50, left: 170 };
      let svg = d3
        .select("svg")
        .attr("width", "100px")
        .attr("height", height)
        .style("position", "absolute")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      let x = d3.scaleLinear().domain([0, 30]).range([0, width]);

      svg
        .append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
        .style("font-family", "Roboto");

      let y = d3.scaleBand().range([height, 0]).domain(countries).padding(1);

      svg
        .append("g")
        .attr("class", "y-axis")
        .call(d3.axisLeft(y))
        .selectAll("text")
        .style("font-family", "Roboto");
      svg
        .append("text")
        .attr("text-anchor", "end")
        .attr("x", width / 2)
        .attr("y", height + margin.top - 5)
        .text("Percentage")
        .style("font-family", "Roboto");
      svg
        .append("text")
        .attr("text-anchor", "end")
        .attr("transform", "rotate(-90)")
        .attr("y", -margin.left / 2)
        .attr("x", -height / 2)
        .text("Countries")
        .style("font-family", "Roboto");
      //   function resize() {
      //     width = window.innerWidth * 0.4;
      //     height = window.innerHeight * 0.8;

      //     x.range([0, width]);
      //     y.range([height, 0]);

      //     svg
      //       .attr("width", width + margin.left + margin.right)
      //       .attr("height", height + margin.top + margin.bottom)
      //       .select("g")
      //       .attr(
      //         "transform",
      //         "translate(" + margin.left + "," + margin.top + ")"
      //       );

      //     svg.select(".y-axis").call(d3.axisLeft(y));

      //     svg
      //       .select(".y-axis-title")
      //       .attr("y", -margin.left / 2)
      //       .attr("x", -height / 2);

      //     update(currentYear.toString());
      //   }
      //   window.addEventListener("resize", resize);
      function update(year) {
        let yearData = data
          .filter((d) => countries.includes(d.country))
          .map((d) => ({
            country: d.country,
            value: isNaN(parseFloat(d.years[year]))
              ? 0
              : parseFloat(d.years[year]),
          }))
          .sort((a, b) => b.value - a.value);
        const maxValue = d3.max(yearData, (d) => d.value);

        x.domain([0, maxValue]);

        svg
          .select(".x-axis")
          .transition()
          .duration(1000)
          .call(d3.axisBottom(x));

        y.domain(yearData.map((d) => d.country));

        // Transition y-axis
        svg.select(".y-axis").transition().duration(1000).call(d3.axisLeft(y));

        let lines = svg.selectAll(".line").data(yearData, (d) => d.country);

        // Update existing lines
        lines
          .transition()
          .duration(1000)
          .attr("x1", (d) => x(0))
          .attr("y1", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("x2", (d) => x(d.value))
          .attr("y2", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("stroke", (d) => (d.country === "EU" ? "#FF5733" : "black"))
          .attr("stroke-width", 2)
          .style("stroke-dasharray", "3, 3");

        // Create new lines
        lines
          .enter()
          .append("line")
          .classed("line", true)
          .attr("x1", (d) => x(0))
          .attr("y1", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("x2", (d) => x(0))
          .attr("y2", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("stroke", (d) => (d.country === "EU" ? "#FF5733" : "black"))
          .attr("stroke-width", (d) => (d.country === "EU" ? 2 : 1.5))
          .style("stroke-dasharray", "3, 3")
          .transition()
          .duration(1000)
          .attr("x2", (d) => x(d.value));
        // Join the data to the circles
        let circles = svg.selectAll("circle").data(yearData, (d) => d.country);

        const tooltip = d3
          .select(".map-container")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        circles
          .transition()
          .duration(1000)
          .attr("cx", (d) => x(d.value))
          .attr("cy", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("r", (d) => (d.value === 0 ? 0 : 6))
          .style("fill", (d) => (d.country === "EU" ? "#FF5733" : "#3467eb"))
          .attr("d", d3.symbol().type(d3.symbolStar))
          .on("mouseover", function (event, d) {
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip
              .html(d.country + ": " + d.value + "%")
              .style("left", event.pageX + "px")
              .style("top", event.pageY - 28 + "px");
          })
          .on("mouseout", function (d) {
            tooltip.transition().duration(500).style("opacity", 0);
          });

        circles
          .enter()
          .append("circle")
          .attr("cx", (d) => x(0))
          .attr("cy", (d) => y(d.country) + y.bandwidth() / 2)
          .attr("r", (d) => (d.value === 0 ? 0 : 6))
          .style("fill", (d) => (d.country === "EU" ? "#FF5733" : "#3467eb"))
          .classed("EUcircle", (d) => (d.country === "EU" ? true : false))
          .attr("d", d3.symbol().type(d3.symbolStar))
          .on("mouseover", function (event, d) {
            const svgRect = svg.node().getBoundingClientRect();

            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip
              .html(d.country + ": " + d.value + "%")
              .style("left", event.clientX - svgRect.left + 80 + "px")
              .style(
                "top",
                event.clientY - svgRect.top + window.scrollY + "px"
              );
            d3.select(this)
              .transition()
              .duration(200)
              .attr("r", 10)
              .style("fill", (d) =>
                d.country === "EU" ? "#FFDDC1" : "#c5d4fa"
              )
              .style("stroke", "#fabea7")
              .style("stroke-width", "2");
          })
          .on("mouseout", function (d) {
            tooltip.transition().duration(500).style("opacity", 0);

            d3.select(this)
              .transition()
              .duration(200)
              .attr("r", 6)
              .style("fill", (d) =>
                d.country === "EU" ? "#FF5733" : "#3467eb"
              )
              .style("stroke", "none");
          })
          .transition()
          .duration(1000)
          .attr("cx", (d) => x(d.value));
        lines.exit().remove();
        circles.exit().remove();
      }

      const availableYears = [
        "2010",
        "2012",
        "2013",
        "2014",
        "2015",
        "2017",
        "2019",
        "2021",
      ];

      let currentYearIndex = availableYears.indexOf(currentYear);

      function updateVisualizationForYear(year) {
        document.querySelector(".year-display").textContent = "Year: " + year;
        update(year);
      }

      document
        .getElementById("nextYear")
        .addEventListener("click", function () {
          if (currentYearIndex < availableYears.length - 1) {
            currentYearIndex++;
            currentYear = availableYears[currentYearIndex];
            updateVisualizationForYear(currentYear);
          }
        });

      document
        .getElementById("prevYear")
        .addEventListener("click", function () {
          if (currentYearIndex > 0) {
            currentYearIndex--;
            currentYear = availableYears[currentYearIndex];
            updateVisualizationForYear(currentYear);
          }
        });

      updateVisualizationForYear(currentYear);
    </script>
  </body>
</html>
